---
import Header from "../components/Header.astro"
import Layout from "../layouts/Layout.astro"
---

<Layout>
    <Header/>
    <div>
        <h1>Register</h1>
        <form action="/register" method="post" id="register-form">
            <label>
                Firstname: <input type="text" id="fname" name="fname">
            </label>
            <label>
                Lastname: <input type="text" id="lname" name="lname">
            </label>
            <label>
                Age: <input type="number" id="age" name="age">
            </label>
            <label>
                Nationality: <input type="text" id="nationality" name="nationality">
            </label>
            <label>
                Mail: <input type="text" id="mail" name="mail">
            </label>
            <label>
                Username: <input type="text" id="username" name="username">
            </label>
            <label>
                Password: <input type="password" id="password" name="password">
            </label>
            <button type="submit">Create Account</button>
        </form>
    </div>
</Layout>

<script>
    const register = document.querySelector("#register-form") as HTMLFormElement
    register.addEventListener("submit",async(e)=>{
        e.preventDefault()

        // pass the data
        const formdata = new FormData(e.target as HTMLFormElement)
        const formObj = Object.fromEntries(formdata.entries())

        const res = await fetch("http://localhost:3000/register",{
            method: "POST",
            credentials: "include",
            headers:{
                "Content-Type": "application/json"
            },
            // send the data
            body: JSON.stringify(formObj)
        })

        if(!res.ok){
            window.location.href = "/register"
        }

        window.location.href = "/login"
    })
</script>